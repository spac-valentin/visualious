var layoutManager={pinManager:{pinnedPostsList:new Array,index:0,pin:function(a){console.log("pin manager trying to pin !"),$("#pinAction").removeClass("no-display"),$(a).toggleClass("pinned"),$(a).hasClass("pinned")?($(a).attr("src","./../resources/img/icons/pinned.png"),this.pinnedPostsList.push(a),this.index++):($(a).attr("src","./../resources/img/icons/pin.png"),this.pinnedPostsList.splice($.inArray(a,this.pinnedPostsList),1),this.index--,console.log(this.pinnedPostsList.length),0==this.pinnedPostsList.length&&$("#pinAction").addClass("no-display"))},"goto":function(a){var b=$(a).parent().parent().parent().parent();$("body, html").stop(!0,!0).animate({scrollTop:b.offset().top-$("#header").height()},"slow",function(){b.fadeTo(350,.3).fadeTo(350,1)})},previousPin:function(){console.log("previus pin was clicked"),this.index>0?this.index--:0==this.index&&(this.index=this.pinnedPostsList.length-1);var a=this.pinnedPostsList[this.index];this["goto"](a)},nextPin:function(){console.log("next pin was clicked"),this.index<this.pinnedPostsList.length-1?this.index++:this.index>=this.pinnedPostsList.length-1&&(this.index=0);var a=this.pinnedPostsList[this.index];this["goto"](a)}},eventsManager:{helper:{likechecked:function(a){id_question=$(a).data("id-question"),id_respunse=$(a).data("id-response"),console.log(id_question+" "+id_respunse),console.log(a);var b=$(a).parent().parent(),c=$(b).find("input:checked");this.changeCheckedPropL(c,"like",id_question,id_respunse,"dislike",0)},dislikechecked:function(a){id_question=$(a).data("id-question"),id_respunse=$(a).data("id-response"),console.log(id_question+" "+id_respunse),console.log(a);var b=$(a).parent().parent(),c=$(b).find("input:checked");this.changeCheckedPropL(c,"dislike",id_question,id_respunse,"like",0)},changeCheckedPropL:function(a,b,c,d,e,f){for(console.log(a.length+" "+b+" "+c+" "+d),0==a.length?Ajax.feedback_resuls(b,c,d,-1):Ajax.feedback_resuls(b,c,d,1),i=0;i<a.length;i++)temp=a[i],console.log(temp),temp.name==e&&(f?$(temp).prop("checked",!0):$(temp).prop("checked",!1))},mapper:function(a,b,c){alert("Working?!"),alert(a+" "+b+" "+c)}},layout:{masonryOptions:{itemSelector:".answer"},_grid_:null,masoneryActive:!1,currentLayout:null,initGrid:function(){$("main").removeClass("list"),$("main").addClass("grid"),this.changeCheckedProp(".layout-option","List",0),this.masoneryActive&&(this._grid_.masonry("destroy"),this.masoneryActive=!1),this.masoneryActive=!0,this._grid_=$("main").masonry(this.masonryOptions)},initList:function(){this.masoneryActive&&(this._grid_.masonry("destroy"),this.masoneryActive=!1),$("main").removeClass("grid"),$("main").addClass("list"),this.changeCheckedProp(".layout-option","Grid",0)},restyleitems:function(){console.log(),"Grid"==this.currentLayout&&(this.masoneryActive&&(this._grid_.masonry("destroy"),this.masoneryActive=!1),this.masoneryActive=!0,this._grid_=$("main").masonry(this.masonryOptions))},changeCheckedProp:function(a,b,c){var d;d=c?a+" input":a+" input:checked";var e=$(d);for(console.log(e.length),i=0;i<e.length;i++){console.log(e[i]);var f=e[i];if(f.id==b){c?$(f).prop("checked",!0):$(f).prop("checked",!1);break}}}},bindEvents:function(){detach=!0,callTimeout=null,$(document).on("click",".innerCall",function(){return Ajax.question_url(this.href),!1}),$("#toggle").on("click",function(){$(".search-option").toggle("fast")}),$(window).resize(function(){var a=$(window).width();a>=720&&$(".search-option").css("display","block")})}}},Ajax={current_questionid:null,current_offset:null,submitForm:function(){var a=$("#searchForm").prop("action")+"/?q="+$("#search-input").val()+"&";1==$("#Text").prop("checked")&&(a+=$("#Text").serialize(),a+="&"),1==$("#Video").prop("checked")&&(a+=$("#Video").serialize(),a+="&"),1==$("#Image").prop("checked")&&(a+=$("#Image").serialize(),a+="&"),1==$("#Map").prop("checked")&&(a+=$("#Map").serialize()),Template.display(a)},dataForType:function(a){var b=$("#searchForm").prop("action")+"/?q="+$("#search").val()+"&";b+=a+"=true",Template.display(b)},add_more_question:function(){console.log("more questions"),full_url="/api/query/topSearches",$.ajax({type:"GET",url:full_url,dataType:"text"}).done(function(a){console.log(" loading services: "),console.log(a);var b=jQuery.parseJSON(a);console.log("-----"),console.log(b),Template.initializeLayout(b),layoutManager.eventsManager.layout.restyleitems()}).fail(function(a){console.log("Error loading services: "),console.log(a)})},demo:function(){var a=this;$(".answer").remove();var b="/api/query?q=",c=$("#search-input").val();console.log("Query: "+c);var d=b+c;console.log("Url: "+d),$.ajax({type:"GET",url:d,dataType:"text"}).done(function(b){console.log(" loading services: "),console.log(b);var c=jQuery.parseJSON(b);return console.log("-----"),console.log(c),current_offset=c.dbpedia.length+c.freebase.length,0==current_offset?void a.add_more_question():(c.dbpedia.length>0&&(current_questionid=c.dbpedia[0].questionId),c.freebase.length>0&&(current_questionid=c.freebase[0].questionId),console.log(this.current_questionid+" "+this.current_offset),Template.initializeLayout(c),void layoutManager.eventsManager.layout.restyleitems())}).fail(function(b){console.log("Error loading services: "),console.log(b),a.add_more_question()})},question_url:function(a){var b=this;console.log("Url: "+a),$(".answer").remove(),$.ajax({type:"GET",url:a,dataType:"text"}).done(function(a){console.log(" loading services: "),console.log(a);var c=jQuery.parseJSON(a);return console.log("-----"),console.log(c),current_offset=c.dbpedia.length+c.freebase.length,0==current_offset?void b.add_more_question():(c.dbpedia.length>0&&(current_questionid=c.dbpedia[0].questionId),c.freebase.length>0&&(current_questionid=c.freebase[0].questionId),console.log(current_questionid+" "+current_offset),Template.initializeLayout(c),void layoutManager.eventsManager.layout.restyleitems())}).fail(function(a){console.log("Error loading services: "),console.log(a),b.add_more_question()})},more_question_results:function(){console.log(current_questionid+" "+current_offset);var a="/api/question/"+current_questionid+"?offset="+current_offset+"&max=10";console.log(a),$.ajax({type:"GET",url:a,dataType:"text"}).done(function(a){console.log(" loading services: "),console.log(a);var b=jQuery.parseJSON(a);console.log("-----"),console.log(b),b.dbpedia.length+b.freebase.length==0?(console.log("No more data!"),$(".more-data").addClass("no-display")):(current_offset+=b.dbpedia.length+b.freebase.length,b.dbpedia.length>0&&(current_questionid=b.dbpedia[0].questionId),b.freebase.length>0&&(current_questionid=b.freebase[0].questionId),console.log(this.current_questionid+" "+this.current_offset),Template.initializeLayout(b),layoutManager.eventsManager.layout.restyleitems())}).fail(function(a){console.log("Error loading services: "),console.log(a)})},feedback_resuls:function(a,b,c,d){var e="/api/question/"+b+"/"+c+"/"+a+"/"+d;console.log(e),$.ajax({type:"POST",url:e,dataType:"text"}).done(function(a){console.log(a)}).fail(function(a){console.log("Error loading services: "),console.log(a)})}},Template={display:function(a){var b=$("#answerArticle").html(),c=Handlebars.compile(b);$.getJSON(a).done(function(a){var b={answer:a},d=c(b);$(main).append(d),layoutChanger()}).fail(function(){console.log("error")})},initializeMap:function(a){var b,c=$("#map-canvas > meta:nth-child(1)").prop("content"),d=$("#map-canvas > meta:nth-child(2)").prop("content"),e=new google.maps.LatLng(c,d),f={zoom:12,center:e};b=new google.maps.Map(document.getElementById("map-canvas"+a),f);new google.maps.Marker({position:e,map:b,title:"Faculty of Computer Science, Iasi"})},initializeLayout:function(a){var b=a.entityType,c="Person",d="Weapon",e="Conflict",f="Album",g="Location",h="EducationInstitution",i="Song",j=!1;b==c&&(Template.displayPerson(a),j=!0),b==d&&(Template.displayWeapon(a),j=!0),b==e&&(Template.displayConflict(a),j=!0),b==f&&(Template.displayAlbum(a),j=!0),b==g&&(Template.displayLocation(a),j=!0),b==h&&(Template.displayEducation(a),j=!0),b==i&&(Template.displaySong(a),j=!0),j||Template.displayMoreLinks(a)},displayMoreLinks:function(a){var b=$("#more_question-template").html();console.log(b);var c=Handlebars.compile(b),d=c({answer:a});console.log(d),$(main).append(d)},displayPerson:function(a){var b=$("#person-template").html();console.log(b);var c=Handlebars.compile(b),d=c({answer:a.dbpedia});console.log(d),$(main).append(d),d=c({answer:a.freebase}),$(main).append(d)},displayWeapon:function(a){var b=$("#weapon-template").html();console.log(b);var c=Handlebars.compile(b),d=c({answer:a.dbpedia});console.log(d),$(main).append(d)},displayConflict:function(a){var b=$("#conflict-template").html();console.log(b);var c=Handlebars.compile(b),d=c({answer:a.dbpedia});console.log(d),$(main).append(d),d=c({answer:a.freebase}),console.log(d),$(main).append(d)},displayAlbum:function(a){var b=$("#album-template").html();console.log(b);var c=Handlebars.compile(b),d=c({answer:a.dbpedia});console.log(d),$(main).append(d),d=c({answer:a.freebase}),console.log(d),$(main).append(d)},displayLocation:function(a){var b=$("#location-template").html();console.log(b);var c=Handlebars.compile(b),d=c({answer:a.dbpedia});console.log(d),$(main).append(c({answer:a.dbpedia})).ready(function(){console.log(a.dbpedia),$.each(a.dbpedia,function(a,b){if(console.log(b),b.body.geolocation){console.log(b.body.geolocation.latitude+" "+b.body.geolocation.longitude);{var c=new google.maps.LatLng(b.body.geolocation.latitude,b.body.geolocation.longitude),d={center:c,zoom:6},e=new google.maps.Map(document.getElementById("minimap"+b.id),d);new google.maps.Marker({position:c,map:e,title:b.body.name})}}})}),d=c({answer:a.freebase}),console.log(d),$(main).append(c({answer:a.freebase})).ready(function(){console.log(a.freebase),$.each(a.freebase,function(a,b){if(console.log(b),b.body.geolocation){console.log(b.body.geolocation.latitude+" "+b.body.geolocation.longitude);{var c=new google.maps.LatLng(b.body.geolocation.latitude,b.body.geolocation.longitude),d={center:c,zoom:6},e=new google.maps.Map(document.getElementById("minimap"+b.id),d);new google.maps.Marker({position:c,map:e,title:b.body.name})}}})})},displayEducation:function(a){var b=$("#education-template").html();console.log(b);var c=Handlebars.compile(b),d=c({answer:a.dbpedia});console.log(d),$(main).append(c({answer:a.dbpedia})).ready(function(){console.log(a.dbpedia),$.each(a.dbpedia,function(a,b){if(console.log(b),b.body.geolocation){console.log(b.body.geolocation.latitude+" "+b.body.geolocation.longitude);{var c=new google.maps.LatLng(b.body.geolocation.latitude,b.body.geolocation.longitude),d={center:c,zoom:6},e=new google.maps.Map(document.getElementById("minimap"+b.id),d);new google.maps.Marker({position:c,map:e,title:b.body.name})}}})}),d=c({answer:a.freebase}),console.log(d),$(main).append(c({answer:a.freebase})).ready(function(){console.log(a.freebase),$.each(a.freebase,function(a,b){if(console.log(b),b.body.geolocation){console.log(b.body.geolocation.latitude+" "+b.body.geolocation.longitude);{var c=new google.maps.LatLng(b.body.geolocation.latitude,b.body.geolocation.longitude),d={center:c,zoom:6},e=new google.maps.Map(document.getElementById("minimap"+b.id),d);new google.maps.Marker({position:c,map:e,title:b.body.name})}}})})},displaySong:function(a){var b=$("#song-template").html();console.log(b);var c=Handlebars.compile(b),d=c({answer:a.dbpedia});console.log(d),$(main).append(c({answer:a.dbpedia})).ready(function(){console.log(a.dbpedia),$.each(a.dbpedia,function(a,b){if(console.log(b),b.body.geolocation){console.log(b.body.geolocation.latitude+" "+b.body.geolocation.longitude);{var c=new google.maps.LatLng(b.body.geolocation.latitude,b.body.geolocation.longitude),d={center:c,zoom:6},e=new google.maps.Map(document.getElementById("minimap"+b.id),d);new google.maps.Marker({position:c,map:e,title:b.body.name})}}})}),d=c({answer:a.freebase}),console.log(d),$(main).append(c({answer:a.freebase})).ready(function(){console.log(a.freebase),$.each(a.freebase,function(a,b){if(console.log(b),b.body.geolocation){console.log(b.body.geolocation.latitude+" "+b.body.geolocation.longitude);{var c=new google.maps.LatLng(b.body.geolocation.latitude,b.body.geolocation.longitude),d={center:c,zoom:6},e=new google.maps.Map(document.getElementById("minimap"+b.id),d);new google.maps.Marker({position:c,map:e,title:b.body.name})}}})})}};$(document).ready(function(){console.log("doc ready"),layoutManager.eventsManager.bindEvents(),Handlebars.registerHelper("ifEqual",function(a,b,c){return a===b?c.fn(this):c.inverse(this)}),$("#search-input").on("input",function(){detach&&(detach=!1,$("#header").removeClass("center"),$("#header").addClass("top"),$(".img-logo img").prop("src","./../resources/img/logo-md-white.png"),layoutManager.eventsManager.layout.changeCheckedProp(".layout-option","List",1),layoutManager.eventsManager.layout.initList())}),$("input[type=checkbox]").click(function(){console.log("was click "+this.id),"Grid"==this.name&&(layoutManager.eventsManager.layout.initGrid(),layoutManager.eventsManager.layout.currentLayout="Grid"),"List"==this.name&&(layoutManager.eventsManager.layout.initList(),layoutManager.eventsManager.layout.currentLayout="List")})}),$(window).scroll(function(){$(window).scrollTop()+$(window).height()==$(document).height()&&$(".more-data").removeClass("no-display")});